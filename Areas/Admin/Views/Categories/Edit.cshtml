@model EduFlex.Areas.Admin.ViewModels.CategoryEditViewModel
@{
    Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";
    ViewData["Title"] = "Chỉnh sửa danh mục";
}

<main id="main" class="main">
    <div class="pagetitle">
        <h2>@ViewData["Title"]</h2>
    </div>

    <section class="section dashboard">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card shadow-sm">
                    <div class="card-body p-4">

                        <form asp-action="Edit" method="post" enctype="multipart/form-data">
                            @Html.AntiForgeryToken()
                            <input type="hidden" asp-for="CategoryId" />

                            <!-- Tên danh mục -->
                            <div class="mb-4">
                                <label asp-for="CategoryName" class="form-label fw-semibold"></label>
                                <input asp-for="CategoryName" class="form-control form-control-lg" placeholder="VD: Lập trình Python" />
                                <span asp-validation-for="CategoryName" class="text-danger small"></span>
                            </div>

                            <!-- Icon hiện tại + upload mới -->
                            <div class="mb-4">
                                <label asp-for="IconFile" class="form-label fw-semibold"></label>
                                
                                @if (!string.IsNullOrEmpty(Model.CurrentIcon))
                                {
                                    <div class="text-center mb-3 p-3 border rounded bg-light">
                                        <img src="@Model.CurrentIcon" 
                                             alt="Icon hiện tại" 
                                             class="img-thumbnail"
                                             style="width: 100px; height: 100px; object-fit: cover;"
                                             onerror="this.src='/uploads/categories/default.png';" />
                                        <p class="mt-2 mb-0 text-muted small">Icon hiện tại</p>
                                    </div>
                                }

                                <input asp-for="IconFile" class="form-control" accept="image/*" />
                                <div class="form-text">
                                    <i class="bi bi-info-circle"></i> 
                                    Chỉ upload nếu muốn thay đổi icon. Đề xuất: 64x64px hoặc 128x128px
                                </div>
                            </div>

                            <!-- Mô tả -->
                            <div class="mb-4">
                                <label asp-for="Description" class="form-label fw-semibold"></label>
                                <textarea asp-for="Description" class="form-control" rows="4"
                                          placeholder="Mô tả ngắn gọn về danh mục này..."></textarea>
                            </div>

                            <!-- Danh mục cha -->
                            <div class="mb-4">
                                <label asp-for="ParentCategoryId" class="form-label fw-semibold"></label>
                                <select asp-for="ParentCategoryId" 
                                        class="form-select" 
                                        asp-items="@(ViewBag.ParentCategories as SelectList)">
                                    <option value="">-- Không có danh mục cha --</option>
                                </select>
                            </div>

                            <!-- Trạng thái -->
                            <div class="mb-4">
                                <div class="form-check form-switch">
                                    <input asp-for="IsActive" class="form-check-input" type="checkbox" id="isActiveSwitch" />
                                    <label class="form-check-label fw-semibold" for="isActiveSwitch">
                                        @if (Model.IsActive)
                                        {
                                            <span class="text-success"><i class="bi bi-check-circle-fill"></i> Danh mục đang hoạt động</span>
                                        }
                                        else
                                        {
                                            <span class="text-danger"><i class="bi bi-x-circle-fill"></i> Danh mục đã bị ẩn</span>
                                        }
                                    </label>
                                </div>
                            </div>

                            <!-- Nút hành động -->
                            <div class="text-end pt-3 border-top">
                                <button type="submit" class="btn btn-success btn-lg px-5">
                                    <i class="bi bi-check-circle"></i> Cập nhật
                                </button>
                                <a asp-action="Index" class="btn btn-secondary btn-lg ms-2 px-4">
                                    <i class="bi bi-arrow-left"></i> Quay lại
                                </a>
                            </div>
                        </form>

                    </div>
                </div>
            </div>
        </div>
    </section>
</main>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}